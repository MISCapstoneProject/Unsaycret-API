# Unsaycret API æ–‡æª”

æœ¬é …ç›®æä¾›èªéŸ³è™•ç†èˆ‡èªªè©±è€…ç®¡ç†çš„APIæœå‹™ã€‚

### èªéŸ³è™•ç†API
- `POST /transcribe` - èªéŸ³è½‰éŒ„èˆ‡èªªè©±è€…è­˜åˆ¥

### èªªè©±è€…ç®¡ç†API
- `POST /speaker/rename` - èªªè©±è€…æ”¹å
- `POST /speaker/transfer` - è²ç´‹è½‰ç§»
- `GET /speaker/{speaker_id}` - èªªè©±è€…è³‡è¨ŠæŸ¥è©¢


## ğŸ“‹ APIè©³ç´°èªªæ˜

### 1. èªéŸ³è½‰éŒ„åŠŸèƒ½

**ç«¯é»**: `POST /transcribe`

**åŠŸèƒ½**: ä¸Šå‚³éŸ³è¨Šæª”æ¡ˆé€²è¡ŒèªéŸ³åˆ†é›¢ã€èªªè©±è€…è­˜åˆ¥èˆ‡èªéŸ³è½‰éŒ„

**è«‹æ±‚æ ¼å¼**: `multipart/form-data`
- **file** (required): éŸ³è¨Šæª”æ¡ˆ (æ”¯æ´ `.wav`, `.mp3`, `.m4a` ç­‰æ ¼å¼)

**å›æ‡‰æ ¼å¼**:
```json
{
  "segments": [
    {
      "speaker_id": "81d60ed8-3c8b-43b8-808d-2dd4409ca814",
      "speaker_name": "ç‹å°æ˜",
      "start_time": 0.0,
      "end_time": 3.5,
      "text": "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°£å¾ˆå¥½",
      "confidence": 0.95
    },
    {
      "speaker_id": "a372ca19-8531-4f3d-bee2-a7580989acf6",
      "speaker_name": "æå°è¯",
      "start_time": 3.6,
      "end_time": 7.2,
      "text": "æ˜¯çš„ï¼Œå¾ˆé©åˆå‡ºå»èµ°èµ°",
      "confidence": 0.92
    }
  ],
  "pretty": "ç‹å°æ˜: ä½ å¥½ï¼Œä»Šå¤©å¤©æ°£å¾ˆå¥½\næå°è¯: æ˜¯çš„ï¼Œå¾ˆé©åˆå‡ºå»èµ°èµ°"
}
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
# ä½¿ç”¨ curl ä¸Šå‚³éŸ³è¨Šæª”æ¡ˆ
curl -X POST "http://localhost:8000/transcribe" \
     -H "accept: application/json" \
     -H "Content-Type: multipart/form-data" \
     -F "file=@your_audio_file.wav"
```

### 1. èªªè©±è€…æ”¹ååŠŸèƒ½

**ç«¯é»**: `POST /speaker/rename`

**åŠŸèƒ½**: æ›´æ”¹æŒ‡å®šèªªè©±è€…çš„åç¨±

**è«‹æ±‚æ ¼å¼**:
```json
{
  "speaker_id": "èªªè©±è€…çš„UUID",
  "current_name": "ç•¶å‰åç¨±",
  "new_name": "æ–°åç¨±"
}
```

**å›æ‡‰æ ¼å¼**:
```json
{
  "success": true,
  "message": "æˆåŠŸå°‡èªªè©±è€… 'èˆŠåç¨±' æ›´åç‚º 'æ–°åç¨±'",
  "data": {
    "speaker_id": "èªªè©±è€…çš„UUID",
    "old_name": "èˆŠåç¨±",
    "new_name": "æ–°åç¨±"
  }
}
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
curl -X POST "http://localhost:8000/speaker/rename" \
     -H "Content-Type: application/json" \
     -d '{
       "speaker_id": "123e4567-e89b-12d3-a456-426614174000",
       "current_name": "ç‹å°æ˜",
       "new_name": "ç‹å¤§æ˜"
     }'
```

### 2. è²ç´‹è½‰ç§»åŠŸèƒ½

**ç«¯é»**: `POST /speaker/transfer`

**åŠŸèƒ½**: å°‡ä¸€å€‹èªªè©±è€…çš„æ‰€æœ‰è²ç´‹è½‰ç§»åˆ°å¦ä¸€å€‹èªªè©±è€…ï¼Œä¸¦åˆªé™¤ä¾†æºèªªè©±è€…

**è«‹æ±‚æ ¼å¼**:
```json
{
  "source_speaker_id": "ä¾†æºèªªè©±è€…çš„UUID",
  "source_speaker_name": "ä¾†æºèªªè©±è€…åç¨±",
  "target_speaker_id": "ç›®æ¨™èªªè©±è€…çš„UUID",
  "target_speaker_name": "ç›®æ¨™èªªè©±è€…åç¨±"
}
```

**å›æ‡‰æ ¼å¼**:
```json
{
  "success": true,
  "message": "æˆåŠŸå°‡èªªè©±è€… 'ä¾†æºåç¨±' çš„æ‰€æœ‰è²ç´‹è½‰ç§»åˆ° 'ç›®æ¨™åç¨±' ä¸¦åˆªé™¤ä¾†æºèªªè©±è€…",
  "data": {
    "source_speaker_id": "ä¾†æºèªªè©±è€…UUID",
    "source_speaker_name": "ä¾†æºèªªè©±è€…åç¨±",
    "target_speaker_id": "ç›®æ¨™èªªè©±è€…UUID",
    "target_speaker_name": "ç›®æ¨™èªªè©±è€…åç¨±"
  }
}
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
curl -X POST "http://localhost:8000/speaker/transfer" \
     -H "Content-Type: application/json" \
     -d '{
       "source_speaker_id": "123e4567-e89b-12d3-a456-426614174000",
       "source_speaker_name": "éŒ¯èª¤è­˜åˆ¥çš„èªªè©±è€…",
       "target_speaker_id": "987fcdeb-51d3-12a4-b567-426614174111",
       "target_speaker_name": "æ­£ç¢ºçš„èªªè©±è€…"
     }'
```

### 3. èªªè©±è€…è³‡è¨ŠæŸ¥è©¢

**ç«¯é»**: `GET /speaker/{speaker_id}`

**åŠŸèƒ½**: ç²å–æŒ‡å®šèªªè©±è€…çš„è©³ç´°è³‡è¨Š

**å›æ‡‰æ ¼å¼**:
```json
{
  "speaker_id": "èªªè©±è€…çš„UUID",
  "speaker_name": "èªªè©±è€…åç¨±",
  "created_time": "å‰µå»ºæ™‚é–“",
  "last_active_time": "æœ€å¾Œæ´»èºæ™‚é–“",
  "voiceprint_count": 5
}
```

## éŒ¯èª¤è™•ç†

æ‰€æœ‰APIéƒ½åŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼š

- **400 Bad Request**: åƒæ•¸éŒ¯èª¤æˆ–é©—è­‰å¤±æ•—
- **404 Not Found**: æ‰¾ä¸åˆ°æŒ‡å®šçš„èªªè©±è€…
- **500 Internal Server Error**: ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤

éŒ¯èª¤å›æ‡‰æ ¼å¼ï¼š
```json
{
  "detail": "éŒ¯èª¤æè¿°"
}
```

## å•Ÿå‹•æœå‹™

### 1. ç’°å¢ƒæº–å‚™
```bash
# å®‰è£ä¾è³´å¥—ä»¶
pip install -r requirements.txt

# å•Ÿå‹•Weaviateè³‡æ–™åº«
docker-compose up -d
```

### 2. å•Ÿå‹•APIæœå‹™
```bash
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ main.py
python main.py

# æ–¹æ³•äºŒï¼šä½¿ç”¨ uvicorn å‘½ä»¤
uvicorn services.api:app --reload

# æ–¹æ³•ä¸‰ï¼šæŒ‡å®šä¸»æ©Ÿå’Œç«¯å£
uvicorn services.api:app --host 0.0.0.0 --port 8000 --reload
```

### 3. è¨ªå•APIæ–‡æª”
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc


## å®‰å…¨æ³¨æ„äº‹é …

1. **åç¨±é©—è­‰**: APIæœƒé©—è­‰æä¾›çš„ç•¶å‰åç¨±æ˜¯å¦èˆ‡è³‡æ–™åº«ä¸­çš„åç¨±åŒ¹é…ï¼Œä»¥é˜²æ­¢æ„å¤–æ“ä½œ
2. **UUIDé©—è­‰**: æœƒæª¢æŸ¥æä¾›çš„Speaker IDæ˜¯å¦å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­
3. **æ“ä½œä¸å¯é€†**: è²ç´‹è½‰ç§»æ“ä½œæœƒåˆªé™¤ä¾†æºèªªè©±è€…ï¼Œè«‹è¬¹æ…ä½¿ç”¨
4. **æ—¥èªŒè¨˜éŒ„**: æ‰€æœ‰æ“ä½œéƒ½æœƒè¨˜éŒ„åœ¨ç³»çµ±æ—¥èªŒä¸­ï¼Œä¾¿æ–¼è¿½è¹¤å’Œé™¤éŒ¯

## æ¸¬è©¦

å¯ä»¥ä½¿ç”¨æä¾›çš„æ¸¬è©¦è…³æœ¬é€²è¡ŒåŠŸèƒ½æ¸¬è©¦ï¼š
```bash
python examples/test_speaker_api.py
```

## å¸¸è¦‹å•é¡Œ

**Q: è²ç´‹è½‰ç§»æœƒå½±éŸ¿èªéŸ³è­˜åˆ¥çš„æº–ç¢ºæ€§å—ï¼Ÿ**
A: è½‰ç§»æ“ä½œåªæ˜¯å°‡è²ç´‹è³‡æ–™å¾ä¸€å€‹èªªè©±è€…é—œè¯åˆ°å¦ä¸€å€‹èªªè©±è€…ï¼Œä¸æœƒæ”¹è®Šè²ç´‹å‘é‡æœ¬èº«ï¼Œå› æ­¤ä¸æœƒå½±éŸ¿è­˜åˆ¥æº–ç¢ºæ€§ã€‚

**Q: å¦‚æœæä¾›éŒ¯èª¤çš„ç•¶å‰åç¨±æœƒæ€æ¨£ï¼Ÿ**
A: APIæœƒå›å‚³400éŒ¯èª¤ï¼Œä¸¦æç¤ºåç¨±ä¸åŒ¹é…ï¼Œæ“ä½œä¸æœƒåŸ·è¡Œã€‚

**Q: è½‰ç§»æ“ä½œå¯ä»¥æ’¤éŠ·å—ï¼Ÿ**
A: ç„¡æ³•è‡ªå‹•æ’¤éŠ·ï¼Œä½†æ‚¨å¯ä»¥æ‰‹å‹•å°‡è²ç´‹å†æ¬¡è½‰ç§»å›åŸä¾†çš„èªªè©±è€…ï¼ˆéœ€è¦é‡æ–°å‰µå»ºèªªè©±è€…ï¼‰ã€‚
