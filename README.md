# Unsaycret-API

## å°ˆæ¡ˆç°¡ä»‹
Unsaycret-API æ˜¯ä¸€å¥—æ¨¡çµ„åŒ–çš„èªéŸ³è™•ç†ç³»çµ±ï¼Œæ•´åˆèªéŸ³åˆ†é›¢ã€èªªè€…è¾¨è­˜ã€èªéŸ³è¾¨è­˜ã€API æœå‹™ï¼Œä¸¦æ”¯æ´å‘é‡è³‡æ–™åº«ä¸²æ¥ã€‚
é€™å°ˆæ¡ˆåŸ·è¡Œå¾Œæœƒæ¶èµ· API ä¼ºæœå™¨ï¼Œä»¥ä¾›å‘¼å«ä½¿ç”¨ã€‚


## ğŸš€ ä¸»è¦åŠŸèƒ½

- ğŸ™ **èªè€…åˆ†é›¢**ï¼šæ¡ç”¨ SpeechBrain Sepformerï¼Œæ”¯æ´é›™äººèªéŸ³åˆ†é›¢ã€‚
- ğŸ§  **èªéŸ³è¾¨è­˜ï¼ˆASRï¼‰**ï¼šFaster-Whisperï¼Œæ”¯æ´ GPU/CPU å‹•æ…‹åˆ‡æ›ï¼Œé€è©æ™‚é–“æˆ³èˆ‡ä¿¡å¿ƒå€¼ã€‚
- ğŸ—£ **èªªè©±äººè¾¨è­˜**ï¼šECAPA-TDNN èªè€…è²ç´‹æ¯”å°ï¼Œæ”¯æ´è²ç´‹è‡ªå‹•æ›´æ–°ã€‚
- ğŸ›œ **API æœå‹™**ï¼šFastAPI æä¾› RESTful èˆ‡ WebSocket ä»‹é¢ã€‚
- ğŸ§  **Weaviate æ•´åˆ**ï¼šèªéŸ³å‘é‡èˆ‡è¾¨è­˜çµæœå¯å­˜å…¥ Weaviateï¼Œæ”¯æ´èªè€…æœå°‹èˆ‡æ¯”å°ã€‚


## ğŸ“‚ ç›®éŒ„çµæ§‹èˆ‡æ¨¡çµ„èªªæ˜

```
Unsaycret-API/
â”œâ”€â”€ examples/                # æ¸¬è©¦èˆ‡ç¯„ä¾‹è…³æœ¬
â”œâ”€â”€ models/                  # èªéŸ³æ¨¡å‹ï¼ˆå«åˆ†é›¢èˆ‡è¾¨è­˜ï¼‰
â”‚   â”œâ”€â”€ faster-whisper/      # Faster-Whisper ASR æ¨¡å‹å¿«å–
â”‚   â”œâ”€â”€ speechbrain_recognition/   # èªè€…è¾¨è­˜æ¨¡å‹æª”
â”‚   â””â”€â”€ speechbrain_Separation_16k/ # èªéŸ³åˆ†é›¢æ¨¡å‹æª”
â”œâ”€â”€ modules/                 # ä¸»è¦è‡ªå®šç¾©åŠŸèƒ½æ¨¡çµ„
â”‚   â”œâ”€â”€ asr/                 # èªéŸ³è¾¨è­˜ï¼ˆASRï¼‰æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ asr_model.py         # Faster-Whisper è¼‰å…¥èˆ‡å°è£
â”‚   â”‚   â”œâ”€â”€ text_utils.py        # æ–‡å­—è™•ç†è¼”åŠ©
â”‚   â”‚   â””â”€â”€ whisper_asr.py       # ASR ä¸»æµç¨‹
â”‚   â”œâ”€â”€ database/            # è³‡æ–™åº«æ“ä½œï¼ˆå¦‚ Weaviateï¼‰
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”œâ”€â”€ identification/      # èªªè©±äººè¾¨è­˜
â”‚   â”‚   â””â”€â”€ VID_identify_v5.py   # èªè€…è¾¨è­˜ä¸»ç¨‹å¼
â”‚   â”œâ”€â”€ management/          # èªè€…/è³‡æ–™ç®¡ç†
â”‚   â”‚   â””â”€â”€ manager.py
â”‚   â”œâ”€â”€ separation/          # èªè€…åˆ†é›¢
â”‚   â”‚   â””â”€â”€ separator.py         # åˆ†é›¢ä¸»æµç¨‹
â”‚   â””â”€â”€ utils/               # å·¥å…·æ¨¡çµ„
â”‚       â””â”€â”€ logger.py            # é›†ä¸­å¼æ—¥èªŒç³»çµ±
â”œâ”€â”€ pipelines/               # è™•ç†æµç¨‹ï¼ˆåˆ†é›¢+è¾¨è­˜ï¼‰
â”‚   â””â”€â”€ orchestrator.py          # åˆ†é›¢+è¾¨è­˜+ASR æ•´åˆæµç¨‹
â”œâ”€â”€ services/                # FastAPI ä¼ºæœå™¨èˆ‡ API å®šç¾©
â”‚   â””â”€â”€ api.py                   # API å…¥å£
â”œâ”€â”€ utils/                   # å…¶ä»–è¼”åŠ©è…³æœ¬
â”‚   â”œâ”€â”€ logger.py
â”‚   â””â”€â”€ sync_npy_username.py
â”œâ”€â”€ weaviate_study/          # Weaviate å‘é‡è³‡æ–™åº«æ•´åˆèˆ‡æ¸¬è©¦
â”‚   â”œâ”€â”€ create_collections.py
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ npy_to_weaviate.py
â”‚   â”œâ”€â”€ test_create_collection_1.py
â”‚   â”œâ”€â”€ test_create_collection_2.py
â”‚   â”œâ”€â”€ tool_delete_all.py
â”‚   â””â”€â”€ tool_search.py
â”œâ”€â”€ work_output/             # è™•ç†çµæœè¼¸å‡ºï¼ˆåˆ†é›¢éŸ³æª”ã€è¾¨è­˜çµæœï¼‰
â”‚   â””â”€â”€ <æ—¥æœŸæ™‚é–“>/              # æ¯æ¬¡è™•ç†è‡ªå‹•å»ºç«‹è³‡æ–™å¤¾
â”‚       â”œâ”€â”€ output.json          # åˆ†é›¢+è¾¨è­˜çµæœ
â”‚       â”œâ”€â”€ speaker1_xxx.wav     # åˆ†é›¢å¾ŒéŸ³æª”
â”‚       â””â”€â”€ speaker2_xxx.wav
â”œâ”€â”€ requirements.txt         # ä¾è³´å¥—ä»¶æ¸…å–®
â”œâ”€â”€ pyproject.toml           # Python å°ˆæ¡ˆæè¿°
â”œâ”€â”€ README.md                # æœ¬èªªæ˜æ–‡ä»¶
â””â”€â”€ ...
```


### å„è³‡æ–™å¤¾/æ¨¡çµ„è©³ç´°èªªæ˜

- **examples/**  
  æ¸¬è©¦èˆ‡ç¯„ä¾‹è…³æœ¬ï¼Œå¿«é€Ÿé©—è­‰å„æ¨¡çµ„åŠŸèƒ½ã€‚

- **models/**  
  - `faster-whisper/`ï¼šASR æ¨¡å‹å¿«å–ï¼ˆè‡ªå‹•ä¸‹è¼‰ï¼‰ã€‚
  - `speechbrain_recognition/`ï¼šèªè€…è¾¨è­˜æ¨¡å‹ï¼ˆECAPA-TDNNï¼‰ã€‚
  - `speechbrain_Separation_16k/`ï¼šèªéŸ³åˆ†é›¢æ¨¡å‹ï¼ˆSepformerï¼‰ã€‚

- **modules/**  
  - `asr/`ï¼šèªéŸ³è¾¨è­˜ï¼ˆASRï¼‰ç›¸é—œæ¨¡çµ„ã€‚
    - `asr_model.py`ï¼šFaster-Whisper è¼‰å…¥èˆ‡å¿«å–ç®¡ç†ã€‚
    - `text_utils.py`ï¼šASR æ–‡å­—è™•ç†è¼”åŠ©ã€‚
    - `whisper_asr.py`ï¼šASR ä¸»æµç¨‹èˆ‡ APIã€‚
  - `database/`ï¼šè³‡æ–™åº«æ“ä½œï¼ˆå¦‚ Weaviateï¼‰ã€‚
    - `database.py`ï¼šè³‡æ–™åº«é€£ç·šèˆ‡æŸ¥è©¢ã€‚
  - `identification/`ï¼šèªªè©±äººè¾¨è­˜ã€‚
    - `VID_identify_v5.py`ï¼šèªè€…è¾¨è­˜ä¸»ç¨‹å¼ï¼Œè²ç´‹æ¯”å°èˆ‡ç®¡ç†ã€‚  - `management/`ï¼šèªè€…èˆ‡è³‡æ–™ç®¡ç†ã€‚
    - `VID_manager.py`ï¼šèªè€…è³‡æ–™ç®¡ç†è¼”åŠ©ã€‚
  - `separation/`ï¼šèªè€…åˆ†é›¢ã€‚
    - `separator.py`ï¼šèªéŸ³åˆ†é›¢ä¸»æµç¨‹ï¼Œå‘¼å« SpeechBrainã€‚
  - `utils/`ï¼šå·¥å…·æ¨¡çµ„ã€‚
    - `logger.py`ï¼šé›†ä¸­å¼æ—¥èªŒç³»çµ±ï¼Œæ”¯æ´å¤šæ¨¡çµ„å…±ç”¨ã€‚

- **pipelines/**  
  - `orchestrator.py`ï¼šåˆ†é›¢ã€è¾¨è­˜ã€ASR æ•´åˆä¸»æµç¨‹ï¼Œä¾› API æˆ– CLI å‘¼å«ã€‚

- **services/**  
  - `api.py`ï¼šFastAPI ä¼ºæœå™¨ä¸»ç¨‹å¼ï¼Œå®šç¾© RESTful èˆ‡ WebSocket ä»‹é¢ã€‚

- **utils/**  
  å…¶ä»–è¼”åŠ©è…³æœ¬ï¼ˆå¦‚æ—¥èªŒã€åŒæ­¥å·¥å…·ï¼‰ã€‚

- **weaviate_study/**  
  Weaviate å‘é‡è³‡æ–™åº«æ•´åˆã€æ¸¬è©¦èˆ‡å·¥å…·è…³æœ¬ï¼ˆå¦‚é›†åˆå»ºç«‹ã€è³‡æ–™åŒ¯å…¥ã€æŸ¥è©¢ã€åˆªé™¤ç­‰ï¼‰ã€‚

- **work_output/**  
  æ¯æ¬¡èªéŸ³è™•ç†çš„çµæœè³‡æ–™å¤¾ï¼ŒåŒ…å«åˆ†é›¢éŸ³æª”èˆ‡è¾¨è­˜çµæœï¼ˆoutput.jsonï¼‰ã€‚


## âš¡ï¸ å¿«é€Ÿå•Ÿå‹•

1. å®‰è£ä¾è³´
   ```cmd
   pip install -r requirements.txt
   ```

2. å•Ÿå‹• FastAPI ä¼ºæœå™¨
   ```cmd
   uvicorn services.api:app --reload
   ```
   - API æ–‡ä»¶ï¼ˆSwagger UIï¼‰ï¼šhttp://localhost:8000/docs

3. æ¸¬è©¦è…³æœ¬
   ```cmd
   python examples/test_modules.py
   ```


## ğŸ³ Docker & Weaviate éƒ¨ç½²æŒ‡å— ï¼ˆ2025â€‘06-16 æ›´æ–°ï¼‰(å¿…è¦æ­¥é©Ÿ)

### 1Â å•Ÿå‹•Â WeaviateÂ +Â Console

```bash
# æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„
docker compose up -d
```

> ç¬¬ä¸€æ¬¡å•Ÿå‹•éœ€ 30â€“60Â ç§’ï¼›åŸ·è¡Œ `docker compose ps`ï¼Œå¾… `STATUS` é¡¯ç¤º **UpÂ (healthy)** å³å®Œæˆã€‚


### 2Â åˆå§‹åŒ–è³‡æ–™çµæ§‹ï¼ˆ**åªéœ€ä¸€æ¬¡**ï¼‰

```bash
python weaviate_study/create_collections.py
```

å°‡ç‚ºèªè€…è³‡è¨Šã€å‘é‡ç´¢å¼•ç­‰å»ºç«‹å¿…è¦ Classï¼›é™¤éæƒ³é‡ç½®è³‡æ–™åº«å…¨éƒ¨ï¼Œå¦å‰‡ä¸å¿…é‡è·‘ã€‚


### ğŸ“¦ è³‡æ–™åº«å‚™ä»½ã€é‚„åŸèˆ‡è½‰ç§»åŠŸèƒ½

å·²å¯¦ç¾è³‡æ–™åº«çš„è³‡æ–™é€²è¡Œå‚™ä»½ã€é‚„åŸèˆ‡è½‰ç§»åŠŸèƒ½ï¼Œæ–¹ä¾¿é€²è¡Œè³‡æ–™ä¿è­·èˆ‡ç’°å¢ƒé·ç§»ã€‚è©³ç´°æ“ä½œæ­¥é©Ÿèˆ‡æŒ‡ä»¤å°‡æ–¼å¾ŒçºŒæ–‡ä»¶è£œå……ã€‚

## ç³»çµ±éœ€æ±‚

- **Python ç‰ˆæœ¬**ï¼šPython 3.8+ (å»ºè­°ä½¿ç”¨ Python 3.10)
- **ä½œæ¥­ç³»çµ±**ï¼šWindows 10/11, Linux, macOS
- **ç¡¬é«”éœ€æ±‚**ï¼š
  - æœ€ä½ï¼š4GB RAMï¼Œ4æ ¸å¿ƒ CPU
  - å»ºè­°ï¼š8GB+ RAMï¼ŒGPU åŠ é€Ÿ(CUDA æ”¯æ´)ä»¥æé«˜è™•ç†é€Ÿåº¦
- **ä¾è³´å¥—ä»¶**ï¼šè«‹åƒé–± `requirements.txt`

## API ä½¿ç”¨ç¯„ä¾‹

### 1. éŸ³æª”è½‰éŒ„ API

```python
import requests

# ç™¼é€éŸ³æª”é€²è¡Œè™•ç†
def transcribe_audio(audio_file_path):
    url = "http://localhost:8000/transcribe"
    
    with open(audio_file_path, "rb") as f:
        files = {"file": f}
        response = requests.post(url, files=files)
    
    if response.status_code == 200:
        result = response.json()
        return result
    else:
        print(f"éŒ¯èª¤: {response.status_code}")
        return None

# ä½¿ç”¨ç¯„ä¾‹
result = transcribe_audio("path/to/your/audio.wav")
print(result["pretty"])  # äººé¡å¯è®€æ ¼å¼
print(result["segments"])  # æ©Ÿå™¨å¯è®€æ ¼å¼(å«æ™‚é–“æˆ³)
```

### 2. è³‡æ–™å¤¾æ‰¹æ¬¡è½‰éŒ„ API

å¯ä»¥ä¸€æ¬¡è™•ç†æ•¸å€‹éŸ³æª”ã€‚åƒ…éœ€å‚³å…¥è·¯å¾‘æˆ–ä¸Šå‚³ ZIP æª”å°±å¯ä»¥å•Ÿå‹•ã€‚

```python
import requests

# å‚³å…¥è·¯å¾‘
resp = requests.post("http://localhost:8000/transcribe_dir", data={"path": "/path/to/wavs"})
print(resp.json()["summary_tsv"])

# ä»¥ ZIP æª”ä¸Šå‚³
with open("audios.zip", "rb") as f:
    resp = requests.post("http://localhost:8000/transcribe_dir", files={"zip_file": f})
print(resp.json()["summary_tsv"])
```

## å…¶ä»–èªªæ˜

- **æ¨¡å‹å¿«å–**ï¼šASR èˆ‡åˆ†é›¢æ¨¡å‹æœƒè‡ªå‹•ä¸‹è¼‰è‡³ `models/` ç›¸é—œè³‡æ–™å¤¾ã€‚
- **æ—¥èªŒç³»çµ±**ï¼šæ‰€æœ‰æ¨¡çµ„çµ±ä¸€ä½¿ç”¨ `utils/logger.py`ï¼Œæ”¯æ´å¤šæª”æ¡ˆèˆ‡é¡è‰²è¼¸å‡ºã€‚
- **Weaviate**ï¼šå¦‚éœ€å‘é‡è³‡æ–™åº«åŠŸèƒ½ï¼Œè«‹å…ˆå•Ÿå‹• docker-compose ä¸¦å»ºç«‹é›†åˆã€‚
- **è²ç´‹ç®¡ç†**ï¼šç³»çµ±æœƒè‡ªå‹•å„²å­˜èªè€…è²ç´‹ï¼Œå¯ç”¨æ–¼å¾ŒçºŒè¾¨è­˜èˆ‡æ¯”å°ã€‚
- **è¼¸å‡ºç›®éŒ„**ï¼šè™•ç†çµæœæœƒå„²å­˜åœ¨ `work_output/<æ—¥æœŸæ™‚é–“>/` ç›®éŒ„ä¸‹ã€‚

## ç³»çµ±å·¥ä½œæµç¨‹

```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ è¼¸å…¥éŸ³è¨Šæª”æ¡ˆ  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ èªè€…åˆ†é›¢ (Separator) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è²ç´‹è¾¨è­˜ (Identifier)  â”‚    â”‚ èªéŸ³è¾¨è­˜ (ASR)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ æ•´åˆçµæœ (Output)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
