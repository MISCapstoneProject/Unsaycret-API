# 環境配置說明

## 配置文件結構

Unsaycret-API 專案採用分層配置管理，將不同性質的設定分別放置：

### 1. `.env` - 環境相關配置
**適合版本控制忽略 (已加入 .gitignore)**

包含需要在不同環境間變動的設定：
- API 服務配置 (主機、端口、日誌等級)
- 資料庫連接設定 (Weaviate 主機、端口)
- 檔案路徑配置 (模型、輸出目錄)
- 硬體設備設定 (GPU/CPU、CUDA 裝置)
- 開發/生產環境標誌

### 2. `.env.example` - 配置範本
**需要版本控制**

提供給新開發者的配置範例，說明所有可用的環境變數及預設值。

### 3. `utils/constants.py` - 應用程式常數
**需要版本控制**

包含演算法核心參數和技術規格：
- 語者識別閾值 (經過實驗調校的演算法參數)
- 音訊處理固定參數 (技術規格要求)
- 模型名稱常數 (HuggingFace 模型 ID)
- WebSocket 處理參數

### 4. `utils/config.py` - 配置載入器
**需要版本控制**

統一的配置載入接口，負責：
- 從 `.env` 載入環境變數
- 從 `constants.py` 導入常數
- 提供類型安全的配置訪問函數

## 配置原則

### ✅ 放在 `.env` 的配置
1. **服務連接資訊**: 主機、端口、URL
2. **環境標誌**: 開發模式、除錯模式、容器模式
3. **檔案路徑**: 可依部署環境調整的路徑
4. **硬體配置**: GPU/CPU 選擇、CUDA 裝置索引

### ❌ 不應放在 `.env` 的設定
1. **演算法參數**: 閾值、權重等核心參數
2. **技術規格**: 固定的取樣率、聲道數
3. **模型常數**: HuggingFace 模型 ID、模型架構參數
4. **業務邏輯常數**: 預設值、限制值

## 新專案設定流程

1. **複製配置範本**:
   ```bash
   cp .env.example .env
   ```

2. **修改環境特定設定**:
   編輯 `.env` 檔案，調整：
   - `WEAVIATE_HOST` 和 `WEAVIATE_PORT` (資料庫位址)
   - `API_HOST` 和 `API_PORT` (服務監聽位址)
   - `MODELS_BASE_DIR` (模型存放路徑)
   - `FORCE_CPU` (是否強制使用 CPU)

3. **不需要修改的檔案**:
   - `utils/constants.py` (除非需要調整演算法參數)
   - `utils/config.py` (配置載入邏輯)

## 團隊開發注意事項

### 版本控制規範
- ✅ 提交 `.env.example` 
- ❌ 提交 `.env` (已在 .gitignore 中)
- ✅ 提交 `utils/constants.py`
- ✅ 提交 `utils/config.py`

### 配置更新流程
1. **新增環境變數**: 先更新 `.env.example`，再通知團隊更新本地 `.env`
2. **調整演算法參數**: 直接修改 `utils/constants.py`
3. **新增配置項目**: 在 `utils/config.py` 中加入載入邏輯

## 常見問題

### Q: 為什麼要分離 `.env` 和 `constants.py`？
A: `.env` 用於環境相關的可變配置，`constants.py` 用於應用程式的固定參數。這樣可以避免將演算法核心參數誤認為是「配置」而隨意修改。

### Q: 如何知道某個參數應該放在哪裡？
A: 問自己：「這個參數在不同的部署環境（開發/測試/生產）中會不同嗎？」
- 會不同 → 放入 `.env`
- 不會不同 → 放入 `constants.py`

### Q: 舊的設定方式還能用嗎？
A: 可以。新的配置系統向下相容，但建議逐步遷移到新的結構以提高可維護性。
